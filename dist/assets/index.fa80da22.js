import{r as e,H as t,V as n,O as r,b as a,u as l,C as s,R as o,d as c,A as i,a as u,E as m,c as d,G as g,e as p,f,g as E,h}from"./vendor.a2935cb2.js";const b=()=>e.exports.createElement(t,{center:!0},e.exports.createElement("div",{className:"loading"},"Loading..."));var x=!!window.location.search.split("debug=")[1];const v=async e=>{const t=new Image;if(e instanceof File){const n=new FileReader;n.onloadend=e=>{t.src=n.result},n.readAsDataURL(e)}else t.src=e;t.setAttribute("crossOrigin",""),await new Promise((e=>{t.onload=()=>e()}));const{naturalHeight:r,naturalWidth:a}=t,l=r*a,s=Math.floor(l/1e5);console.log(`${l} Pixels | Sample Rate ${s}`);const o=document.createElement("canvas");o.width=r,o.height=a;const c=o.getContext("2d");c.drawImage(t,0,0),x&&(e=>{document.querySelector("#root").appendChild(e)})(o);const i=[];for(let u=0;u<a;u++)for(let e=0;e<r;e++)if(e%s==0){const{data:t}=c.getImageData(e,u,1,1),r={r:t[0],g:t[1],b:t[2],a:t[3]};i.push(new n(r.r,r.g,r.b))}return(e=>{const t=e.reduce(((e,t)=>{const n=JSON.stringify(t);return t.x<10&&t.y<10&&t.z<10?e[n]={vector:t,count:1}:e[n]?e[n].count++:e[n]={vector:t,count:1},e}),{});return Object.values(t)})(i)},w=new r,y=({imageSrc:t})=>{const n=e.exports.useRef(),r=a(v,[t]);return l(t),e.exports.useEffect((()=>{n.current&&(r.forEach(((e,t)=>{const r=Math.min(5,e.count);w.position.set(-e.vector.x,e.vector.y,-e.vector.z),w.scale.set(r,r,r),w.updateMatrix(),n.current.setMatrixAt(t,w.matrix);const a=e.vector.normalize(),l=new s(a.x,a.y,a.z);n.current.setColorAt(t,l)})),n.current.instanceMatrix.needsUpdate=!0)}),[r]),r.length?e.exports.createElement("instancedMesh",{ref:n,args:[null,null,r.length],key:r.length},e.exports.createElement("sphereBufferGeometry",{args:[1,32,32]}),e.exports.createElement("meshPhysicalMaterial",{envMapIntensity:.4,clearcoat:.8,clearcoatRoughness:0,roughness:0,metalness:.5})):null};const R=()=>o.createElement("input",{className:"file-input",name:"file",type:"file",id:"imageFile2",capture:"environment",accept:"image/*"}),S=({setImage:t})=>{const n=e.exports.useRef();return e.exports.useEffect((()=>{c.registerDialog(n.current)}),[]),o.createElement("dialog",{ref:n,open:!0},o.createElement("form",{onSubmit:e=>{e.preventDefault();let n=new FormData(e.target);n.fd&&(n=n.fd);const r=n.get("image-src"),a=n.get("file");t(r||a),e.currentTarget.reset()}},o.createElement("label",null,o.createElement("div",null,"Paste an image URL to start"),o.createElement("input",{name:"image-src",type:"url",inputMode:"url",autoFocus:!0})),o.createElement("a",{className:"link",href:"https://unsplash.com",target:"_blank",rel:"noreferrer"},"Try Unsplash",o.createElement("br",null),"The internetâ€™s source of freely-usable images."),o.createElement(R,null),o.createElement("button",{type:"submit"},"Submit")))};var C=!!window.location.search.split("ar=")[1];const M=t=>{const{src:n}=t,[r,a]=e.exports.useState();return e.exports.useEffect((()=>{if(n instanceof File){const e=new FileReader;e.onloadend=t=>{a(e.result)},e.readAsDataURL(n)}else a(n)}),[]),r?o.createElement("img",{className:"thumbnail",src:r,alt:"thumbnail"}):null},F=C?f:E;function k(){const[t,n]=e.exports.useState(null),r=e.exports.useRef();return o.createElement(o.Fragment,null,o.createElement(F,{style:{height:"100vh",width:"100vw",border:"1px solid black"},gl:{antialias:!0,alpha:!1},onCreated:({gl:e})=>e.setClearColor("#000"),mode:"concurrent",shadows:!0,frameloop:"demand"},o.createElement(i,null),o.createElement(u,{makeDefault:!0,position:[70,-50,50],near:1,far:1e3,zoom:5}),o.createElement("ambientLight",null),o.createElement("pointLight",{position:[150,150,150],intensity:.5}),t&&o.createElement(e.exports.Suspense,{fallback:o.createElement(b,null)},o.createElement(y,{imageSrc:t}),o.createElement(m,{preset:"sunset"})),o.createElement(d,{ref:r}),x&&o.createElement(g,{alignment:"bottom-right",margin:[80,80],onTarget:()=>{var e;return null==(e=null==r?void 0:r.current)?void 0:e.target},onUpdate:()=>{var e;return null==(e=r.current)?void 0:e.update()}},o.createElement(p,{axisColors:["red","green","blue"],labelColor:"white"}))),t?o.createElement("div",{className:"flex-center button-container"},o.createElement("button",{onClick:()=>n(null)},"New image"),o.createElement(M,{src:t})):o.createElement(S,{setImage:n}))}h.render(o.createElement(o.StrictMode,null,o.createElement(k,null)),document.getElementById("root"));
