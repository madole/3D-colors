import{r as l,H as h,V as E,O as b,b as y,C as x,R as t,d as v,A as w,a as M,c as R,E as S,M as A,e as C}from"./vendor.f95ecdec.js";const D=function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function a(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerpolicy&&(o.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?o.credentials="include":e.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(e){if(e.ep)return;e.ep=!0;const o=a(e);fetch(e.href,o)}};D();const F=()=>l.exports.createElement(h,{center:!0},l.exports.createElement("div",{className:"loading"},"Loading..."));var I=window.location.search.includes("debug");const L=s=>{document.querySelector("#root").appendChild(s)},O=1e5,P=s=>{const r=s.reduce((a,n)=>{const e=JSON.stringify(n);return n.x<10&&n.y<10&&n.z<10?a[e]={vector:n,count:1}:a[e]?a[e].count++:a[e]={vector:n,count:1},a},{});return Object.values(r)},N=async s=>{const r=new Image;if(s instanceof File){const i=new FileReader;i.onloadend=u=>{r.src=i.result},i.readAsDataURL(s)}else r.src=s;r.setAttribute("crossOrigin",""),await new Promise(i=>{r.onload=()=>i()});const{naturalHeight:a,naturalWidth:n}=r,e=a*n,o=Math.floor(e/O);console.log(`${e} Pixels | Sample Rate ${o}`);const c=document.createElement("canvas");c.width=a,c.height=n;const m=c.getContext("2d");m.drawImage(r,0,0),I&&L(c);const p=[];for(let i=0;i<n;i++)for(let u=0;u<a;u++)if(u%o==0){const{data:d}=m.getImageData(u,i,1,1),g={r:d[0],g:d[1],b:d[2],a:d[3]};p.push(new E(g.r,g.g,g.b))}return P(p)},f=new b,T=({imageSrc:s})=>{const r=l.exports.useRef(),a=y(N,[s]);return l.exports.useEffect(()=>{!r.current||(a.forEach((n,e)=>{const o=Math.min(5,n.count);f.position.set(-n.vector.x,n.vector.y,-n.vector.z),f.scale.set(o,o,o),f.updateMatrix(),r.current.setMatrixAt(e,f.matrix);const c=n.vector.normalize(),m=new x(c.x,c.y,c.z);r.current.setColorAt(e,m)}),r.current.instanceMatrix.needsUpdate=!0)},[a]),a.length?l.exports.createElement("instancedMesh",{ref:r,args:[null,null,a.length],key:a.length},l.exports.createElement("sphereBufferGeometry",{args:[1,20,20]}),l.exports.createElement("meshPhysicalMaterial",{envMapIntensity:.4,clearcoat:.8,clearcoatRoughness:0,roughness:0,metalness:.5})):null};const k=()=>t.createElement("input",{className:"file-input",name:"file",type:"file",id:"imageFile2",capture:"environment",accept:"image/*"}),V=({setImage:s})=>{const r=l.exports.useRef();return l.exports.useEffect(()=>{v.registerDialog(r.current)},[]),t.createElement("dialog",{ref:r,open:!0},t.createElement("form",{onSubmit:a=>{a.preventDefault();let n=new FormData(a.target);n.fd&&(n=n.fd);const e=n.get("image-src"),o=n.get("file");s(e||o),a.currentTarget.reset()}},t.createElement("label",null,t.createElement("div",null,"Paste an image URL to start"),t.createElement("input",{name:"image-src",type:"url",inputMode:"url",autoFocus:!0})),t.createElement("a",{className:"link",href:"https://unsplash.com",target:"_blank",rel:"noreferrer"},"Try Unsplash",t.createElement("br",null),"The internet\u2019s source of freely-usable images."),t.createElement(k,null),t.createElement("button",{type:"submit"},"Submit")))};var B=!!window.location.search.split("ar=")[1];const U=s=>{const{src:r}=s,[a,n]=l.exports.useState();return l.exports.useEffect(()=>{if(r instanceof File){const e=new FileReader;e.onloadend=o=>{n(e.result)},e.readAsDataURL(r)}else n(r)},[]),a?t.createElement("img",{className:"thumbnail",src:a,alt:"thumbnail"}):null},$=B?w:M;function z(){const[s,r]=l.exports.useState(null);return t.createElement(t.Fragment,null,t.createElement($,{style:{height:"100vh",width:"100vw",border:"1px solid black"},gl:{antialias:!0,alpha:!1},onCreated:({gl:a})=>a.setClearColor("#000"),flat:!0,dpr:[1,2],camera:{position:[0,5,8],fov:25}},t.createElement("ambientLight",null),t.createElement("pointLight",{position:[150,150,150],intensity:.5}),t.createElement(R,null),s&&t.createElement(l.exports.Suspense,{fallback:t.createElement(F,null)},t.createElement(T,{imageSrc:s}),t.createElement(S,{preset:"sunset"})),t.createElement("mesh",{rotation:[-Math.PI/2,0,Math.PI/2]},t.createElement("planeGeometry",{args:[1e3,1e3]}),t.createElement(A,{resolution:1024,mirror:.9,mixBlur:100,mixStrength:2,blur:blur||[0,0],minDepthThreshold:.8,maxDepthThreshold:1.2,depthScale:0,depthToBlurRatioBias:.2,debug:0,distortion:0,color:"#a0a0a0",metalness:.5}))),s?t.createElement("div",{className:"flex-center button-container"},t.createElement("button",{onClick:()=>r(null)},"New image"),t.createElement(U,{src:s})):t.createElement(V,{setImage:r}))}C.render(t.createElement(t.StrictMode,null,t.createElement(z,null)),document.getElementById("root"));
